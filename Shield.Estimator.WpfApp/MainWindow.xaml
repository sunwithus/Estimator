<Window x:Class="Shield.Estimator.Wpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Shield.Estimator.Wpf"
        mc:Ignorable="d"
        Title="Voice2Text+ Распознавание речи" 
        Height="620" Width="710"
        MinHeight="300" MinWidth="710"
        
        WindowStartupLocation="CenterScreen">
    <!-- ="images\icon.ico" -->

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
        <local:BoolToVisInverseConverter x:Key="BoolToVisInverse"/>
        <local:PathToFileNameConverter x:Key="PathToFileNameConverter"/>
        
        <local:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
        
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Меню -->
            <RowDefinition Height="Auto"/>
            <!-- Режим работы -->
            <RowDefinition Height="Auto"/>
            <!-- Устройство выполнения -->
            <RowDefinition Height="*"/>
            <!-- Консоль -->
            <RowDefinition Height="Auto"/>
            <!-- Прогресс -->
            <RowDefinition Height="Auto"/>
            <!-- Кнопки -->
        </Grid.RowDefinitions>

        <!-- Меню -->
        <Menu Grid.Row="0">
            
            <MenuItem Header="_Файл">
                <MenuItem Header="_О программе" Click="MenuItemAbout_Click"/>
                <MenuItem Header="_Список языков" Click="MenuItemLang_Click"/>
                <MenuItem Header="_Выход" Click="MenuItemExit_Click"/>
            </MenuItem>
            <!--
            <MenuItem Header="_Справка">
                <MenuItem Header="_О программе" Click="MenuItemAbout_Click"/>
            </MenuItem>
            -->
        </Menu>

        <!-- Выбор режима Net или Faster-->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10" Height="45" IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBooleanConverter}}">
            
            <StackPanel Orientation="Vertical" VerticalAlignment="Center">
                <RadioButton Content="Net" Margin="5"
                       IsChecked="{Binding UseFasterWhisper, Converter={StaticResource InverseBooleanConverter}}"
                       GroupName="WhisperImpl"
                       ToolTip="Реализация Net Whisper"/>
                <RadioButton Content="Faster" Margin="5"
                       IsChecked="{Binding UseFasterWhisper}"
                       GroupName="WhisperImpl"
                       ToolTip="Реализация Faster Whisper"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="40,0,0,0" Width="405" Height="35">
                <!-- Опция для Net -->
                <ComboBox x:Name="ModelComboBox" Margin="5" Width="395" 
                  ItemsSource="{Binding AvailableModels}"
                  SelectedItem="{Binding SelectedModel}"
                  Visibility="{Binding UseFasterWhisper, Converter={StaticResource BoolToVisInverse}}"
                  ToolTip="Выберите модель">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Converter={StaticResource PathToFileNameConverter}}"/>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <!-- Опция для Faster -->
                <CheckBox Content="Диаризация" Margin="5" VerticalAlignment="Center" ToolTip="Разбиение на собеседников"
                    IsChecked="{Binding IsDiarizationEnabled}"
                    Visibility="{Binding UseFasterWhisper, Converter={StaticResource BoolToVis}}"/>
                <!-- Выбор устройства выполнения -->
                <CheckBox Content="CPU" Margin="15,0,0,0" VerticalAlignment="Center" ToolTip="Выбор устройства выполнения"
                          IsChecked="{Binding UseCpu, Mode=TwoWay}"
                          Visibility="{Binding UseFasterWhisper, Converter={StaticResource BoolToVis}}"/>
            </StackPanel>
        </StackPanel>
        
        <!-- Ввод/Вывод выбор директории-->
        <StackPanel Grid.Row="2" Orientation="Vertical" Margin="0,10" IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBooleanConverter}}">
            <StackPanel Orientation="Horizontal">
                <TextBox x:Name="InputPathTextBox" Width="500" Margin="5"/>
                <Button x:Name="SelectInputButton" Content="Входная директория" Width="150"
                      Click="SelectFolder_Click" Margin="5" ToolTip="Путь к аудиофайлам и сохранению результатов транскрибирования"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal">
                <TextBox x:Name="OutputPathTextBox" Width="500" Margin="5"/>
                <Button x:Name="SelectOutputButton" Content="Выходная директория" Width="150"
                      Click="SelectFolder_Click" Margin="5" ToolTip="Путь, куда переместить аудиофайлы из входиной директории после транскрибирования"/>
            </StackPanel>
        </StackPanel>


        <!-- Консоль -->
        <TextBox Grid.Row="3" Margin="5" IsReadOnly="True" 
               Text="{Binding ConsoleMessage}"
               VerticalScrollBarVisibility="Auto"
               HorizontalScrollBarVisibility="Auto"
               TextWrapping="Wrap"
               AcceptsReturn="True"/>

        <!-- Прогресс -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Stretch">


             <TextBlock Text="CPU:" Margin="5"/>
            <ProgressBar Width="70" Height="20" Minimum="0" Maximum="100" Value="{Binding CpuUsage}"/>
            <TextBlock Text="{Binding CpuUsage, StringFormat={}{0:0}%}" Margin="5"/>
            
            <TextBlock Text="RAM:" Margin="5"/>
            <ProgressBar Width="70" Height="20" Minimum="0" Maximum="100" Value="{Binding RamUsage}"/>
            <TextBlock Text="{Binding RamUsage, StringFormat={}{0:0}%}" Margin="5"/>
            <TextBlock Text="{Binding MemoryStatus}" Margin="5"/>

                <!-- Text="{Binding CudaMemoryGB}" -->
                <TextBox VerticalAlignment="Center" HorizontalAlignment="Right" Margin="5" Visibility="{Binding CudaAvailable}" Text="{Binding CudaMemoryGB}"
                         ToolTip="Автоопределение характеристик видеокарты"/>

        </StackPanel>

        <!-- Кнопки и статус -->
        <StackPanel Grid.Row="5" Orientation="Horizontal" HorizontalAlignment="Stretch" Margin="0,10">
            <Button Content="Старт" Width="80" Margin="5"
                  Click="StartProcessing_Click"
                  IsEnabled="{Binding IsProcessing, Converter={StaticResource InverseBooleanConverter}}"/>

            <Button Content="Стоп" Width="80" Margin="5"
                  Click="StopProcessing_Click"
                  IsEnabled="{Binding IsProcessing}"/>

            <TextBlock x:Name="LoadingStatusTextBlock" Margin="30,0,0,0" Height="20" 
                     Text="{Binding LoadingStatus}" VerticalAlignment="Center"/>
        </StackPanel>
    </Grid>
</Window>